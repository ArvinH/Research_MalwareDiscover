package netdb.graph.opts.framework;

import java.util.Date;

import netdb.graph.unit.Cacheable;
import netdb.graph.unit.ShutdownHook;

import org.neo4j.graphdb.GraphDatabaseService;

import com.tinkerpop.blueprints.impls.neo4j.Neo4jGraph;

public class GBlock implements Comparable<GBlock>, Cacheable {
  /**
   * blueprint graph
   */
	public static final int MEMORY_GBLOCK = 0;
	public static final int DISK_GBLOCK = 1;
	
	private Neo4jGraph graph;
	private String id;
	private int b_type = -1;

	private Date leastAccessTime;
    
    public GBlock(Neo4jGraph graph, String BorderID){
    	this.leastAccessTime = new Date();
    	this.graph = graph;
    	this.id = BorderID;
    	registerShutdownHook(this.graph);
    	
    }
    public void registerShutdownHook(Neo4jGraph graph){
    	ShutdownHook.registerShutdownHook(graph);
    }

	public boolean isExpired() {
		Date currentTime = new Date();
	    long diff = currentTime.getTime() - this.leastAccessTime.getTime() / (60 * 1000) % 60;	
	    if(diff > 15){
	    	return true;
	    }
	    else{
	    	return false;
	    }
	}

	public String getIdentifier() {
		
		return this.id;
	}
	public Neo4jGraph getGraph(){
		//update the least access time
		this.leastAccessTime = new Date();
		return this.graph;
	}
	
	public void shutdownGB(){
		this.graph.shutdown();
	}


	@Override
	public int compareTo(GBlock o) {
		// TODO Auto-generated method stub
		return 0;
	}


}
